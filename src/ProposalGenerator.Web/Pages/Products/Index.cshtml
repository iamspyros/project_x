@page
@model ProposalGenerator.Web.Pages.Products.IndexModel
@{
    ViewData["Title"] = "Product Catalog";
}

<div class="d-flex justify-content-between align-items-center mb-4">
    <div>
        <h1><i class="bi bi-box-seam me-2"></i>Product Catalog</h1>
        <p class="text-muted mb-0">@Model.Products.Count active products</p>
    </div>
    <div>
        <a asp-page="/PriceImport/Index" class="btn btn-outline-primary">
            <i class="bi bi-upload me-2"></i>Import Prices
        </a>
    </div>
</div>

@if (!string.IsNullOrEmpty(Model.CategoryFilter))
{
    <div class="mb-3">
        <span class="badge bg-primary me-2">Category: @Model.CategoryFilter</span>
        <a asp-page="/Products/Index" class="btn btn-sm btn-outline-secondary">Clear filter</a>
    </div>
}

@{
    var categories = Model.Products
        .Where(p => !string.IsNullOrEmpty(p.Category))
        .Select(p => p.Category!)
        .Distinct()
        .OrderBy(c => c)
        .ToList();
}

@if (categories.Any())
{
    <div class="mb-3">
        <strong class="me-2">Filter by category:</strong>
        @foreach (var cat in categories)
        {
            <a asp-page="/Products/Index" asp-route-category="@cat"
               class="btn btn-sm @(cat == Model.CategoryFilter ? "btn-primary" : "btn-outline-secondary") me-1">
                @cat
            </a>
        }
    </div>
}

<div class="card">
    <div class="card-body p-0">
        <div class="table-responsive">
            <table class="table table-hover mb-0">
                <thead class="table-dark">
                    <tr>
                        <th>SKU</th>
                        <th>Product Name</th>
                        <th>Category</th>
                        <th>Unit Price</th>
                        <th>Commitment</th>
                        <th>Billing</th>
                        <th>Updated</th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (var p in Model.Products)
                    {
                        <tr>
                            <td><code>@p.Sku</code></td>
                            <td>
                                <strong>@p.Name</strong>
                                @if (!string.IsNullOrEmpty(p.Description))
                                {
                                    <br /><small class="text-muted">@p.Description</small>
                                }
                            </td>
                            <td>
                                @if (!string.IsNullOrEmpty(p.Category))
                                {
                                    <span class="badge bg-secondary">@p.Category</span>
                                }
                            </td>
                            <td class="text-end fw-bold">@p.UnitPrice.ToString("N2") @p.Currency</td>
                            <td>@(p.CommitmentTerm ?? "—")</td>
                            <td>@(p.BillingFrequency ?? "—")</td>
                            <td><small class="text-muted">@p.UpdatedAt.ToString("dd MMM yyyy")</small></td>
                        </tr>
                    }
                </tbody>
            </table>
        </div>
    </div>
</div>
